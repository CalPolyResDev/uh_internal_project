#! /bin/bash

source /etc/environment
source /usr/local/bin/virtualenvwrapper.sh

workon resnet_internal_project
GITOUTPUT=$(git pull 2> /dev/null)
SUCCESS=$?
echo $GITOUTPUT | grep 'Already up-to-date.' > /dev/null
UPDATED=$?

if (( $UPDATED == 1 && $SUCCESS == 0 )); then    
    echo $GITOUTPUT
    wipeenv
    pip3 install -r requirements.txt 
    python3 resnet_internal/manage.py migrate --noinput
    python3 resnet_internal/manage.py collectstatic --noinput
    touch conf/uwsgi.ini
fi
