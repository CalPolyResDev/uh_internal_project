{% extends "base_frame.html" %}
{% load core_filters %}
{% load staticfiles %}
{% block subtitle %} | Ticket Summary{% endblock %}

{% block content %}
    <h1>Summary: {{ ticket.summary|clean_srs_escapes }}</h1>
    {% if ticket %}
        <h3>Details:</h3>
        <table>
            <tr>
                <td style="vertical-align: text-top; text-align: right;">
                    <strong>Name:</strong>
                    <br /><strong>Username:</strong>
                    <br /><strong>Status:</strong>
                    <br /><strong>Date Created:</strong>
                    <br /><strong>Last Updated:</strong>
                    <br /><strong>Assigned Team:</strong>
                    <br /><strong>Assigned User:</strong>
                    <br />
                </td>
                <td style="vertical-align: text-top;">
                    {{ ticket.requestor_full_name }}
                    <br />{{ ticket.requestor_username }}
                    <br />{{ ticket.status }}
                    <br />{{ ticket.date_created }}
                    <br /><span class="{{ date_display_class }}">{{ ticket.date_updated }}</span>
                    <br />{{ ticket.assigned_team }}
                    <br />{{ ticket.assigned_person }}
                </td>
                <td style="vertical-align: text-top; text-align: right;">
                    <strong>Ticket #:</strong>
                    <br /><strong>Phone:</strong>
                    <br /><strong>Dorm Address:</strong>
                    <br /><strong>Department:</strong>
                    <br /><strong>Building:</strong>
                    <br /><strong>Room:</strong>
                    <br /><strong>Edit Ticket:</strong>
                    <br />
                </td>
                <td style="vertical-align: text-top;">
                    {{ ticket.ticket_id }}
                    <br />{{ ticket.formatted_requestor_phone }}
                    <br />{{ ticket.requestor_housing_address }}
                    <br />{{ ticket.requestor_department }}
                    <br />{{ ticket.requestor_building }}
                    <br />{{ ticket.requestor_room }}
                    <br /><a href="https://calpoly.enterprisewizard.com/gui2/cas-login?KB=calpoly2&state=Edit:helpdesk_case&record={{ ticket.ticket_id }}&gui=Staff&record_access=Edit" target="_blank"><img src="{% static 'images/srs_edit_button.gif' %}"></a>
                </td>
            </tr>
        </table>
        <p><h3>Description:</h3> {{ ticket.formatted_description|linebreaksbr }}</p>
        <table>
            <tr>
                <td style="vertical-align: text-top; width: 50%;">
                    <p><h3>Requestor Notes:</h3>
                        {% for note in ticket.requestor_notification_dict %}
                                <strong>[{{ note.first_name }} {{ note.last_name }} {{ note.timestamp }}]</strong>
                                <br /><br />{{ note.message|linebreaksbr }}
                                <br /><br />
                        {% endfor %}
                    </p>
                </td>
                <td style="vertical-align: text-top; width: 50%;">
                    <p><h3>Work Log:</h3>
                        {% for note in ticket.work_log_dict %}
                                <strong>[{{ note.first_name }} {{ note.last_name }} {{ note.timestamp }}]</strong>
                                <br /><br />{{ note.message|linebreaksbr }}
                                <br /><br />
                        {% endfor %}
                    </p>
                </td>
            </tr>
        </table>
        
    {% else %}
        <p>Could not retrieve ticket.</p>
    {% endif %}
{% endblock %}

